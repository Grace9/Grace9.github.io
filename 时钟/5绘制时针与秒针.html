<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>title</title>
</head>

<body>
    <canvas id="canvas" width="800" height="600" style="border:1px solid #000;"></canvas>
    <script src="jquery-2.1.4.js"></script>
    <script>
        function Clock(opt) {
            if (!opt) throw new Error("请提供参数");
            var requireArgs = "bigX,bigY,bigR".split(",");
            requireArgs.forEach(function(v) {
                if (!opt.hasOwnProperty(v)) throw new Error("请给参数提供属性：" + v);
            });
            var defaultOpt = {
                bigColor: "#335F9A",
                bigLineWidth: 2
            }
            $.extend(this, defaultOpt, opt);
            this.ctx = this.canvas.getContext("2d");
            this.ctx.font = "20px 微软雅黑";
            this.ctx.textAlign = "center";
            this.ctx.textBaseline = "middle";
            this.init();
        };
        Clock.prototype = {
            constructor: Clock,
            init: function() {
                this.drawBigCircle();
                this.drawTicks();
                this.drawPoints();
            },
            //绘制蓝色大圆
            drawBigCircle: function() {
                var ctx = this.ctx;
                ctx.beginPath();
                ctx.strokeStyle = this.bigColor;
                ctx.lineWidth = this.bigLineWidth;
                ctx.arc(this.bigX, this.bigY, this.bigR, 0, 2 * Math.PI);
                ctx.stroke();
            },
            //绘制刻度线
            drawTicks: function() {
                var ctx = this.ctx;
                ctx.strokeStyle = "black";
                //为了设置文字的时候方便，让起点从-Math.PI / 3
                var startRadian = -Math.PI / 3;
                for (var i = 0; i < 60; i++) {
                    //处理刻度线长度和线宽
                    var length;
                    var width;
                    length = this.tick[i % 5 == 0 ? "big" : "small"].length;
                    width = this.tick[i % 5 == 0 ? "big" : "small"].width;

                    //相邻刻度线之间的弧度差
                    var singleRadian = 2 * Math.PI / 60;
                    //计算出每一个刻度线的弧度值
                    var radian = startRadian + i * singleRadian;

                    //为什么要用this.bigR - this.bigLineWidth / 2刻度线才会在大圆下？因为链接两点都是从中线开始，改变连接点从边缘开始
                    var h1 = Math.sin(radian) * (this.bigR - this.bigLineWidth / 2);
                    var b1 = Math.cos(radian) * (this.bigR - this.bigLineWidth / 2);

                    //起点
                    var x1 = this.bigX + b1;
                    var y1 = this.bigY + h1;

                    var h2 = Math.sin(radian) * (this.bigR - length);
                    var b2 = Math.cos(radian) * (this.bigR - length);

                    //终点
                    var x2 = this.bigX + b2;
                    var y2 = this.bigY + h2;

                    ctx.beginPath();
                    ctx.lineWidth = width;
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    ctx.stroke();
                    //绘制文字(只给5的倍数设置)
                    if (i % 5 == 0) {
                        this.drawText(i / 5 + 1, radian);
                    }
                }
            },
            /**
             * 根据文字的弧度和内容绘制文字
             * @param text 文字的内容
             * @param radian 文字的弧度
             */
            drawText: function(text, radian) {
                var ctx = this.ctx;
                var h1 = Math.sin(radian) * (110);
                var b1 = Math.cos(radian) * (110);

                //起点
                var x = this.bigX + b1;
                var y = this.bigY + h1;

                ctx.fillText(text, x, y);

            },
            drawPoints: function() {

                //1、来一个固定时间
                var date = new Date("2017-06-23 8:30:20");
                //2、获取时分秒的值
                var hour = date.getHours() % 12; //返回值0-23,我们需要的值是1到12
                var minute = date.getMinutes();
                var second = date.getSeconds(); //15秒-->3的位置

                //3、根据时间确定弧度（由于有误差，本来是在3的位置，结果是在7的位置，需要减去2 * Math.PI / 3）
                //绘制分针
                var secondRadian = second * 2 * Math.PI / 60 - 2 * Math.PI / 3;
                var secondLength = 50; //相当于指针画出圆的半径
                this.drawSinglePoint(secondRadian, secondLength, "black");
                //秒针绘制
                var minuteRadian = minute * 2 * Math.PI / 60 - 2 * Math.PI / 3;
                var minuteLength = 40;
                this.drawSinglePoint(minuteRadian, minuteLength, "blue");
                //时针绘制
                var hourRadian = hour * 2 * Math.PI / 12 - 2 * Math.PI / 3;
                var hourLength = 30;
                this.drawSinglePoint(hourRadian, hourLength, "red");
            },
            //绘制单个指针
            drawSinglePoint: function(radian, length, color) {
                var ctx = this.ctx;
                var b1 = Math.cos(radian) * length;
                var h1 = Math.sin(radian) * length;

                var x = this.bigX + b1;
                var y = this.bigY + h1;

                ctx.beginPath();
                ctx.strokeStyle = color;

                ctx.moveTo(this.bigX, this.bigY);
                ctx.lineTo(x, y);
                ctx.stroke();
            }
        };
        var opt = {
            canvas: document.querySelector("#canvas"),
            bigX: 300,
            bigY: 300,
            bigR: 150,
            bigColor: "gray",
            bigLineWidth: 10,
            tick: {
                //小刻度线
                small: {
                    length: 15,
                    width: 4
                },
                //大刻度线
                big: {
                    length: 26,
                    width: 8
                }
            }
        };
        var clock = new Clock(opt);
    </script>
</body>

</html>